视频地址：https://www.bilibili.com/video/BV1iE411J7Dt?from=search&seid=3390996451632705577

# 一、DB2 简介 

## 1、DB2 简介及发展历史

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/654b5354-8b4a-4a6d-8733-c112a8ed4421.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/8be13646-cc07-4f5b-bf1a-546f850541e7.jpg)

IBM中文官网：https://www.ibm.com/cn-zh

## 2、DB2 支持的平台和版本

### （1）IBM的主机体系简介

广泛使用的是小型机（在大多中小企业、政府、银行中主要做数据库和高性能运算）

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6e99d214-a350-4917-ae2c-56bc6b3df543.jpg)

### （2）DB2支持的平台

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/160afd7a-c5f2-41b8-bb2d-14558173cac6.jpg)

### （3）DB2的版本

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/d25ae6e9-0803-43c1-a7c0-5f81815e797b.jpg)

#### ① DB2 Express-C

快捷社区版，提供了DB2基本的数据库能力，最大的特点就是免费、启动快，可用于经常测试的开发环境。最大支持2个CPU和16G的内存。入门级的版本。

#### ② DB2 Express

收费但是不是很贵，适用于小型企业，是全功能性数据库，支持8个CPU和64G内存。

#### ③ DB2 Workgroup Server

DB2工作组版，适合部门或中型企业环境，是全功能性的数据库，可部署于Linux\Unix\Windows系统中，支持16个CPU和128G内存。

#### ④ DB2 Enterprise Server

企业服务器版，无CPU和内存限制，适合于任何工作负载的环境，包含前面所有数据库版本的所有功能。

#### ⑤ DB2 Advanced Enterprise Server Edition

高级企业服务器版，无CPU和内存限制，适合于任何工作负载的环境，包含前面所有数据库版本的所有功能。额外多包含了一组完整的工具组件。

#### ⑥ IBM InfoSphere Warehouse

特殊的数据库版本，适用于数据仓库的环境。最大特点是支持分区数据库（将数据库部署在多台单独的主机中，但不同于数据库集群）。

#### ⑦ DB2 pureScale feature

DB2软件带的特性，以组件的方式集成在DB2的软件中，很多的DB2软件版本中已经附带了这个组件，这个组件可以实现DB2数据库的集群。

## 3、DB2 主要产品组件及功能

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/966b4955-2879-4653-bf5a-f75b76769b73.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/46bb13e1-a142-4982-84a2-3861a8bbb1b3.jpg)

## 4、DB2 体系结构简介

### （1）DB2体系结构简图

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/be76df62-030d-4df3-a299-70f3b287822c.jpg)

### （2）数据库管理实例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f0235bc9-9b3e-461f-bf98-a4254fa4f297.jpg)

### （3）数据库

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/804d0372-a882-479e-8600-11a0448aafc6.jpg)

### （4）表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7aecb430-db49-4018-89c1-f0c68e0f8c99.jpg)

### （5）表

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ec957483-19d5-46e6-b346-cc8e607ce4ea.jpg)

### （6）示例-查看各组件

#### ① 查看实例

```shell
 # 进入实例用户
 su - db2inst1
# 启动
db2start
# 连接数据库test，指定用户和密码
db2 connect to test user db2inst1 using 123456

# 查看实例
db2ilist
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f1deaf8e-7f22-48ac-9f73-60c0b7cf2ef7.png)

#### ② 查看数据库

```shell
db2 list db directory
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/fcfa3b5c-4c80-4162-8f7a-f515eb406d64.png)

#### ③ 查看表空间

```shell
db2 list tablespaces
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/4b08a855-bc44-4658-97ba-da88114b4d17.png)

# 二、DB2 安装

为知笔记地址：[CentOS7 安装/卸载DB2_Express-C_V10.5](wiz://open_document?guid=ff3233d1-7dbc-458c-9260-508f3d05fd7f&kbguid=&private_kbguid=9e15e816-792d-4528-9d21-a849cc4117d5)

GitHub地址：[https://github.com/wangliu1102/StudyNotes/tree/master/%E5%B0%9A%E7%A1%85%E8%B0%B7Java/%E5%85%AD%E3%80%81Java%E8%BF%9B%E9%98%B6/DB2/%E5%AE%89%E8%A3%85](https://github.com/wangliu1102/StudyNotes/tree/master/尚硅谷Java/六、Java进阶/DB2/安装)

# 三、DB2 实例与管理服务器

## 1、理解实例

### （1）实例的概念

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5ca60862-954b-4290-99fd-bdd2c95b7006.jpg)

### （2）创建几个实例合适

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1358fa4c-00c8-48c8-a175-50c7422586a7.jpg)

## 2、管理实例

### （1）创建实例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1f245738-f05f-4e8e-864c-0de88d001040.jpg)

#### ① Linux&Unix 创建实例语法

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f3a332e1-2bcc-40c1-9488-f414e0bdd84c.jpg)

#### ② Windows 创建实例语法

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/cb412b0e-177c-4c45-9330-3ee14e4c9ba5.jpg)

#### ③ 创建实例示例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/969f0d59-d5bb-46c9-ac8b-365e24c0d86d.jpg)

 

```shell
cd /opt/ibm/db2/V10.5/instance/

# 创建DB2实例
# db2icrt创建的是实例，这里db2fenc1指定db2inst1为它的防护用户，而db2inst1为一实例名称，实例名和实例用户名称一致。
./db2icrt -u db2fenc1 db2inst1
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/4d659dd2-472c-4ce5-88e7-a61f4c790b13.png)

### （2）启动实例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c5fb4e37-cebe-4d09-8323-ca00d00578e7.jpg)

 

```shell
su - db2inst1
# 启动
db2start
```

### （3）连接和断开实例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/05458b9c-44ef-40cb-a1cd-5c30f026aae8.jpg)

### （4）停止实例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6d9041ca-9af2-4e6c-9809-74bf08251655.jpg)

### （5）实例参数

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/08da8f2b-32d3-4926-b10b-0c06cbec07e3.jpg)

### （6）删除实例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/08c9d387-7f96-44e8-a932-2321c46a5d06.jpg)

### （7）操作实例的其他命令

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ecb2664b-6795-404f-b56f-53eda4ff2132.jpg)

## 3、DB2的环境变量

### （1）环境变量的优先级

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a7c57294-885c-4728-8239-0176c9fb6c49.jpg)

### （2）管理实例注册变量

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e3444c89-33fe-4974-a877-0168f9e8ffdb.jpg)

## 4、实例目录

### （1）概念与作用

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/d37f90a5-23cb-4768-b36c-bf6e29aa001d.jpg)

### （2）实例目录的内容

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a9fb9d16-0507-499e-8512-1fa28e92434c.jpg)

## 5、管理服务器

### （1）概念与作用

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/fce71dc9-0b57-468c-8769-97c05c6f7dd4.jpg)

**DB2 V9.7开始推荐不使用DAS**

### （2）管理命令

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/31ed2ec0-fb6a-4519-9db3-e103c2450320.jpg)

## 6、演示DB2实例操作

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7fc1b8e6-bb22-4afd-a1bc-2611dcb60014.jpg)

### （1）查看db2icrt和db2idrop所在的路径

```shell
cd /opt/ibm/db2/V10.5/
ls
cd instance/
ls
```



![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/137df1cf-edc7-4772-aba7-9c2c2fbb1af1.png)

### （2）检查是否创建了受防护的用户和实例用户，并且设置密码

```shell
# 防护的用户
id db2fenc1

# 实例用户
id db2inst1
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0cf2e5ad-3690-463a-b173-096966bb6030.png)

### （3）在创建实例前，查看home路径下是否有sqllib目录

```shell
# 默认是/home/db2inst1，这里因为我安装配置的时候指定到了/home/DB2/db2inst1
cd /home/DB2/db2inst1
ls
```

### （4）若没有，则创建实例

```shell
# 创建DB2实例
./db2icrt -u db2fenc1 db2inst1
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/48962b01-1333-492a-b5cc-407bd697b393.png)

### （5）检查sqllib目录是否创建成功

```shell
# 默认是/home/db2inst1，这里因为我安装配置的时候指定到了/home/DB2/db2inst1
cd /home/DB2/db2inst1
ls
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/d5561ad5-f0fb-426e-b721-2e310f66b38f.png)

### （6）启动实例

```shell
su - db2inst1
# 启动
db2start
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5ff5ca76-b457-4104-9abd-1de4fa6757e1.png)

### （7）连接到实例 

```shell
db2 attach to db2inst1
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/63ed5ba9-01fa-41b9-bd17-54864319d02f.png)

### （8）从实例中断开

```shell
db2 detach
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/33ab558b-511c-4014-96a8-b34f3a562861.png)

### （9）停止实例

```shell
db2stop
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7745a5f1-3f0f-4cb0-af6b-6c30e3ec93da.png)

### （10）启动实例并创建一个测试数据库

```shell
su - db2inst1
# 启动
db2start

# 创建测试库，安装配置的时候创建过了，有就不用再创建了
db2 create database test
```

### （11）额外用一个用户连接实例，在停止实例

```shell
# 另起终端来连接test
db2 connect to test

# 这个时候当前终端停止失败
db2stop # 失败

# 此时强制停止即可
db2stop force
```



![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/79fcd717-e2d6-4b43-a092-84e92af4a108.jpg)

### （12）查看实例的参数，必须先启动实例

```shell
su - db2inst1
# 启动
db2start

# 查看实例的参数
db2 get dbm cfg

# 更改参数，例如：
db2 update dbm cfg using ASLHEAPSZ 20
```

### （13）删除实例，必须先停止实例，在root用户下操作

```shell
# 停止
db2stop

# 退出
exit

# 删除
cd /opt/ibm/db2/V10.5/instance/
./db2idrop db2inst1
```

### （14）检查sqllib目录是否还存在

```shell
# 默认是/home/db2inst1，这里因为我安装配置的时候指定到了/home/DB2/db2inst1
cd /home/DB2/db2inst1
ls
```



# 四、创建数据库

## 1、建库前准备

### （1）数据库、表空间、表的关系

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/bf2307a5-4344-47b8-9c5a-c2e2ae5e5d88.jpg)

### （2）表空间、容器、区与数据页

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/cb52ff36-92fb-4237-9c00-037eb9e7a408.jpg)

### （3）容器与表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/92995cc2-752b-4950-bf81-4fdcb4c04b13.jpg)

## 2、使用命令行创建数据库

### （1）创建数据库的语法

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6cf41210-69c6-4989-97f3-ca45784add38.jpg)

### （2）数据库的名称和分区

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/faf79128-42cd-4033-9b29-44aa84cfeb3e.jpg)

### 

### （3）数据库和自动存储的位置

### ![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f3a48b66-6bd1-4772-8765-119b601d9ec5.jpg)![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c378db51-f8fd-4f76-b7ef-e0cde985688e.jpg)（4）别名、代码页和整理次序![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/137a78aa-66b0-4719-b2f9-cec5d0d2b3d0.jpg)（5）数据页与默认区的大小

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/caa0e8ef-a1ab-4f15-bf08-4fa59d7947bc.jpg)

### （6）默认的表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e024923b-6657-4677-a5bc-cd6ee0c8c7e0.jpg)

### （7）演示

```shell
# 启动
su - db2inst1
db2start

# 创建数据库jikedb1
db2 create db jikedb1
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f8dde38e-4bce-4447-a3c1-0880457cd09e.png)

```shell
# 创建数据库jikedb2，之前要创建相应的目录，并给目录赋予实例的权限
mkdir /home/DB2/jikedb2
mkdir /home/DB2/jikedbauto21
mkdir /home/DB2/jikedbauto22
cd /home/DB2/
chown -R db2inst1:db2iadm1 jikedb2
chown -R db2inst1:db2iadm1 jikedbauto21
chown -R db2inst1:db2iadm1 jikedbauto22
# 指定自动存储路径/home/DB2/jikedbauto21、/home/DB2/jikedbauto22
# 指定数据库路径/home/DB2/jikedb2
# 指定别名 myjikedb
# 指定数据页大小8192,即8K
# 指定数据库表空间默认使用8个分区
# 指定数据库的注释信息为my jikedb2
db2 'create db jikedb2 on /home/DB2/jikedbauto21,/home/DB2/jikedbauto22 dbpath on /home/DB2/jikedb2 
alias myjikedb pagesize 8192 dft_extent_sz 8 with "my jikedb2"';
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/dcb22b2c-7f37-4f91-8597-8fc06a1645d2.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ee9fe135-fe20-48a8-8a90-29d49db5c3b1.png)

```shell
# 查看创建的数据库
db2 list db directory
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e7e717d6-da41-40d1-9a35-b926e3c053e4.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a2f2d961-17a1-4de5-a75c-0bcef59664a8.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0eafcb2a-539b-4114-b464-bf83c07825f9.png)

## 3、数据库的目录 

### （1）数据库的目录

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/33c9df8e-d9c8-44fd-b819-28bc9edce9bc.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b0a50f9b-9ca4-4e9c-9c4d-50d943ebb942.png)

### （2）分区全局目录

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3f9a8f4f-c033-4d4f-a73d-ef0143b4701d.jpg)

### （3）特定成员目录

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6a5673c3-b3a5-476b-a1a5-c7d0a083aecc.jpg)

# 五、DB2 表空间的管理

## 1、了解表空间

### （1）表空间的作用

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/49704cd6-cb9c-4bbb-a73f-834c53b8e553.jpg)

### （2）表空间的类型

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1968f3fc-4c7a-49de-beb2-58b78ebaee89.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/76dfbce1-f1bc-452b-9474-94c5630207d8.jpg)

### （3）表空间存储的类型

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ed10801e-c437-477b-b62a-9f1db80e324d.jpg)

#### ① SMS:系统管理的表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/8d10da7b-592a-4e3b-93ec-bcf846811b5d.jpg)

#### ② DMS: 数据库管理的表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/787a71a7-b165-41e3-b0c3-fbd188d3ea3d.jpg)

#### ③ 自动存储管理的表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/782fa18c-0c2c-4c02-9351-d06bf4b2385e.jpg)

### （4）表空间大小的限制

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ffb44102-7bf8-48b9-8407-94d6981e4ebc.jpg)

## 2、创建表空间

### （1）创建表空间的语法

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f83e5f91-2c14-4560-bcc4-2e1818a3a98a.jpg)

表空间自选项：

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e386b4ca-52db-4af6-8d04-eba7bef7e714.jpg)

### （2）指定表空间类型和名称

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5aad288f-226a-4da1-a661-3e93ccca38f0.jpg)

### （3）数据库分区组和数据页大小

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c68c3bb2-0042-4551-9735-65cb49c0d632.jpg)

### （4）表空间存储的管理方式和区大小

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/bf20cc45-64f2-4eab-844c-28f4a6881809.jpg)

### （5）预取页的大小与缓冲池

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b047faa8-743a-4719-9773-a73749de57d2.jpg)

### （6）开销和传送速率

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2fda9361-9d48-4fb0-b349-11154b1d68a8.jpg)

### （7）文件系统缓存和已删除表的恢复

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7955d797-4f43-4094-a54c-9053b864f576.jpg)

### （8）演示

```shell
# 启动
su - db2inst1
db2start

# 查看现有的数据库
db2 list db directory

# 使用JIKEDB1数据库
# 连接数据库JIKEDB1
db2 connect to jikedb1

# 1、创建表空间最简单的命令
db2 create tablespace jikesimple;

# 2、创建一个大型表空间
db2 create large tablespace jikelarge;

# 3、创建一个用户临时表空间
db2 create user temporary tablespace jikeusertemp;

# 4、创建一个8K页大小的表空间
db2 create tablespace jike8K pagesize 8k; #失败，默认缓冲池对应大小是4k，修改为4k即可创建成功
db2 create tablespace jike4K pagesize 4k; #成功

# 5、创建一个数据库管理的表空间
# 创建表空间之前需要创建目录/dbpath，且赋予实例的权限，否则报错
mkdir /dbpath
chown -R db2inst1:db2iadm1 /dbpath/

db2 "create tablespace jikedms managed by database using (file '/dbpath/jikdms01.dbf' 10m , file '/dbpath/jikdms02.dbf' 10m)";
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ef6f8427-c624-4d9d-af88-9e68d0a3f67d.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/074c0e24-7197-47c3-9ba4-46a1d71364d3.png)

## 3、维护表空间

```shell
# 查看之前需要先启动并连接数据库
su - db2inst1
db2start
db2 connect to test
```

### （1）查看表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/de8637c0-d35d-4b23-a58d-6b529302f4f5.jpg)

 

```shell
# 查看表空间
db2 list tablespaces
# 查看表空间及详情
db2 list tablespaces show detail
```

### （2）查看表空间的容器

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2acbb149-0541-464e-96de-136dbc8a9b3a.jpg)

### （3）修改表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1498439c-5c3c-42b2-9e7a-be0ddd97c6c7.jpg)

### （4）添加容器

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e36a09da-1815-4e51-80c9-319f423d9d4c.jpg)

### （5）扩展容器 

extend扩展，而resize是重新分配大小（比之前大就扩，比之前小就删）

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/78afb4ce-c2a5-453b-bb1d-05a9a998d5e8.jpg)

### （6）删除容器

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6ef056e8-86c5-4660-9f42-5e2ff415c9ca.jpg)

### （7）重命名表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7a4e2a31-af8e-49f5-9a1f-533edcd6763a.jpg)

### （8）删除表空间

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/49f4d9f0-d0f4-457c-a5ad-73ad6965791b.jpg)

### （9）演示

```shell
# 启动实例
su - db2inst1
db2start

# 查看实例下的数据库
db2 list db directory

# 连接到jikedb1数据库下
db2 connect to jikedb1

# 1、查看表空间
db2 list tablespaces
db2 list tablespaces show detail

# 2、查看某个表空间的容器(表空间id为8的容器)
db2 list tablespace containers for 8
db2 list tablespace containers for 8 show detail

# 3、为表空间添加一个容器
# 创建表空间之前需要创建目录/dbpath，且赋予实例的权限，否则报错,这里因为我之前已经创建好了，所用不用执行下面命令
mkdir /dbpath
chown -R db2inst1:db2iadm1 /dbpath/
# 添加一个容器/dbpath/jikedms03.dbf，大小为10M
db2 "alter tablespace jikedms add (file '/dbpath/jikedms03.dbf' 10m)"
# 查看容器
db2 list tablespace containers for 8 show detail

# 4、修改容器的大小,/dbpath/jikedms03.dbf的大小改为5M
db2 "alter tablespace jikedms resize (file '/dbpath/jikedms03.dbf' 5m)"
# 查看容器
db2 list tablespace containers for 8 show detail

# 5、删除容器
db2 "alter tablespace jikedms drop (file '/dbpath/jikedms03.dbf')"
# 查看容器
db2 list tablespace containers for 8 show detail

# 6、重命名表空间
db2 rename tablespace jikedms to myjikedms
# 查看表空间
db2 list tablespaces

# 7、删除表空间
db2 drop tablespace myjikedms
# 查看表空间
db2 list tablespaces
```

## 4、多温度存储器(V10新特性)

### （1）概述

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0152a4e3-78ed-4803-b884-b992f6b7e615.jpg)

### （2）存储器组

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b8220874-be42-4e25-8cc5-7e447241075f.jpg)

### （3）查看存储器组

第一种方式：

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f2820d5d-7942-4afc-93c0-765a3a204109.jpg)

```shell
db2pd -db jikedb1 -storagegroup
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/fdafded1-f428-428e-ba5e-44b03ed417e2.png)

第二种方式：

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1d59e88a-9d74-4f87-981e-7caf99098e61.jpg)

```shell
db2 "select varchar(storage_group_name,20) as storage_group,
storage_group_id,
varchar(db_storage_path,20) as storage_path,
db_storage_path_state,
(fs_total_size/1000000) as total_path_MB,
(sto_path_free_size/1000000) as path_free_MB
from table(admin_get_storage_paths('',-1)) as T1";
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/dcbf5fef-f423-4544-8d03-aea619146bdb.png)

### 

### （4）创建存储器组

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/94602bb5-9105-4ff7-983e-e155dc65d3c4.jpg)

### （5）修改存储器组

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7f1627e3-db78-477e-9e84-6d166057fc10.jpg)

### （6）删除存储器组

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2e253578-6a53-4cab-a7f0-969239c695ed.jpg)

### （7）表空间与存储器组

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/39e6ae9c-ffd7-490d-9fc2-1156117c324a.jpg)

### （8）查看表空间与存储器组的关系

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/135f0e1b-26a6-4015-b23a-a51698dce069.jpg)

### （9）演示

```shell
# 启动实例
su - db2inst1
db2start

# 查看实例下的数据库
db2 list db directory

# 连接到jikedb1数据库下
db2 connect to jikedb1

# 1、查看存储器组
db2pd -d jikedb1 -storagegroup

db2 "select varchar(storage_group_name,20) as storage_group,
storage_group_id,
varchar(db_storage_path,20) as storage_path,
db_storage_path_state,
(fs_total_size/1000000) as total_path_MB,
(sto_path_free_size/1000000) as path_free_MB
from table(admin_get_storage_paths('',-1)) as T1";

# 2、创建存储器组,路径需要在root用户下提前创建好，并设置为实例用户可读可写的权限
mkdir /home/DB2/db2inst1/sgpath1
chown -R db2inst1:db2iadm1 /home/DB2/db2inst1/sgpath1

db2 "create stogroup sg1 on '/home/DB2/db2inst1/sgpath1'"
#查看
db2pd -d jikedb1 -storagegroup

# 3、创建表空间，指定存储器组
db2 create tablespace jikets1 using stogroup sg1

# 4、查看表空间和存储器组的关系
db2 "select TBSPACE,SGNAME,SGID from syscat.tablespaces"

# 5、删除存储器组，当前存储器组sg1正在被表空间jikets1使用，删除失败，修改表空间jikets1的存储器组为其他再删除即可
db2 drop stogroup sg1

# 6、修改表空间的存储器组
db2 alter tablespace jikets1 using stogroup IBMSTOGROUP
# 再次删除，删除成功
db2 drop stogroup sg1 
```



# 六、DB2数据库备份与恢复的相关概念

## 1、备份的概念

### （1）为什么要备份

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/4246929a-1890-47a2-97a6-149fc9b93902.jpg)

### （2）备份的层级

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/bbfd6b66-6707-4d3f-ab14-1077232ae93a.jpg)

### （3）备份的类型

#### ① 脱机/离线备份

#### ② 在线备份

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7db9a8a5-a964-4ee9-8e4b-3399583677fc.jpg)

#### ③ 全量备份

#### ④ 增量备份

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c81fbba4-c6ec-4371-987c-19e1b9317a12.jpg)

#### ⑤ 变量增量备份

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5de92727-500f-4be1-b9aa-08a5a00fc334.jpg)

#### ⑥ 全量、增量、变量增量备份的综合使用

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5b5f34d8-98e2-4821-b09e-a4a63a06f076.jpg)

## 2、恢复的概念

### （1）恢复的类型

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1152ff2d-a4bd-4e56-89bc-4329be77d9a2.jpg)

#### ① 崩溃恢复（系统默认）

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/9ce63f0e-3cfe-4c9e-b7e3-9530344f7fbf.jpg)

#### ② 版本恢复

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/caac8af8-6b3e-4e1c-8052-73b3ac6e59fc.jpg)

#### ③ 前滚恢复（推荐）

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/989117cb-6f23-4f42-a237-68c09ec11991.jpg)

## 3、事务

### （1）什么是事务

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/326af252-4533-42e4-a1ad-373952e9f469.jpg)

### （2）事务的ACID特性

#### ① 原子性

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/d192cc1a-4658-4947-9848-f26cacd7a1f1.jpg)

#### ② 一致性

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e1312578-6afa-4863-b420-f2344dc9ef0c.jpg)

#### ③ 隔离性

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f39dce50-0235-42da-92d2-27f2ef5f3953.jpg)

#### ④ 持久性

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/73f353a8-2718-4aa5-8978-392b32031e6e.jpg)

## 4、DB2 的日志

### （1）日志的机制与作用

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ff3925af-3a34-4dad-8392-79b717d44f4b.jpg)

### （2）日志文件命令

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ecca9d7b-7d59-4063-874e-f1567a554bf8.jpg)

### （3）日志的类型

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/77c5914f-ba91-40b2-8d2d-fb91ece82205.jpg)

### （4）日志的配置方式

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/9b9c4b0f-5114-4504-9001-69ab6d2c3d84.jpg)

#### ① 循环日志（默认）

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a9aa3e73-843e-4485-b2a0-97adda23a255.jpg)

#### ② 归档日志（推荐）

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/52d539e3-d856-4ddd-b959-f4e37a04dae5.jpg)

#### ③ 无限循环日志（不推荐）

和循环日志类似，但是无限循环

### （5）与日志相关的参数

#### 主日志文件(logprimary)

#### 辅助日志(logsecond)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ea005544-7d46-41da-9586-1abe9a1aa012.jpg)

#### 归档重试延迟(archretrydelay)

#### 日志磁盘已满时挂起(blk_log_dsk_ful)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a369e6c0-f854-4c92-850f-3d5d788c6170.jpg)

#### 故障转移归档路径(failarchpath)

#### 主日志归档压缩(logarchcompr1)

#### 辅助日志归档压缩(logarchcompr2)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/82c50d6b-8fea-4109-bcc1-0edc69ad220a.jpg)

#### 日志归档方法1(logarchmeth1)

#### 日志归档方法2(logarchmeth2)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0605d9a0-5153-4f85-9ce6-723afff8f870.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/dbbd2cae-be6c-45d9-8eec-40a3713e7b97.jpg)

#### 日志缓冲区(logbufsz)

#### 日志文件大小(logfilsiz)

#### 每个事务的最大日志(max_log)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/94f3230c-d07d-4cf5-90d6-ac7b8d5cf94b.jpg)

#### 镜像日志路径(mirrorlogpath)

#### 新日志路径(newlogpath)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/541ada6f-b423-4b53-8a1a-aba6c60e54f8.jpg)

#### 对组的落实此时(mincommit)

#### 事务可以跨越的活动日志数(num_log_span)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/fd646843-a0fa-4a02-be44-25b6e4380830.jpg)

# 七、DB2数据库与表空间的备份

## 1、详解数据库与表空间的备份语法

### （1）备份语法

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/38f1cd2a-0b07-49c0-80b0-8ccd20f71e50.jpg)

### （2）备份语法详解

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/81dfcaba-a246-4a9f-b513-48d4c6939d1d.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/80bbd5b1-23ba-433b-8771-8c5d3dd2b926.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/9b497196-e79b-492c-9691-fd7a0bbc8d2b.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5717f465-9c84-4b27-b47f-9b001bde1a87.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/8761973f-fa17-4d21-b856-097e95c5b5df.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/45be06ec-7e9a-43d5-ab18-39ea5d2b832f.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1bc54bfb-cf80-4c61-9f84-4a83f75f82f9.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2a5d10eb-ceb3-471a-aa2d-c571d7e9d2f2.jpg)

## 2、备份文件的命名惯例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/99f1fed7-7ead-4fd3-bd27-6ce0a154d110.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e2c37025-c729-4445-bb40-eabacd10aa0b.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1a94a7fb-3833-4c16-abe9-fefa4b0e55d2.jpg)

## 3、备份示例

### （1）离线备份

```shell
# 不要连接到任何数据库中，若之前连接了，就先退出在进入实例启动
db2stop force
exit

# 启动实例
su - db2inst1
db2start

# 查看实例下的数据库
db2 list db directory

# 备份test数据库，将备份文件默认放在当前路径下，默认采用的是离线备份
db2 BACKUP DATABASE test
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/75b569c8-16fc-4773-bb18-6d3e917df348.png)

```shell
# 验证默认采用的是离线备份
# 另起一个窗口，连接到test库上
su - db2inst1
db2 connect to test

# 当前窗口查看连接,可以看到有一个应用程序连接了数据库
db2 list applications
# 再次备份，备份失败
db2 BACKUP DATABASE test
# 查看错误码具体信息:db2 ? 错误码
# 可以看到不能备份的原因是有连接连到该数据库
db2 ? SQL1035N

# 另外一个窗口断开连接
db2 terminate
# 再次回到当前窗口查看连接，没有应用程序连到数据库
# 再次备份，备份成功
db2 BACKUP DATABASE test
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/50114701-107e-41c4-b47d-8327d6ffddfb.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/612a29f1-4298-4557-952e-8a64424876e8.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2f904ec1-24a6-4e19-8b4c-a8ba26465eeb.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6072ec9a-6de2-46e3-9d6e-e34fee7b5892.png)

### （2）在线备份

```shell
# 另起一个窗口，启动并连接到jikedb1库上
su - db2inst1
db2start
# 查看实例下的数据库
db2 list db directory
# 连接到jikedb1数据库
db2 connect to jikedb1

# 当前窗口查看连接,可以看到有一个应用程序连接了数据库
db2 list applications

# 在线备份
# 注意：在循环日志模式(默认)下，是不能够进行在线备份的，如果需要在线备份，需要把数据库改为归档日志模式,否则在线备份报错
# 新建归档目录并授权
mkdir /home/DB2/db2inst1/arch2
chown -R db2inst1:db2iadm1 /home/DB2/db2inst1/arch2
# 断开连接后，jikedb1库启用归档日志,日志路径在/home/DB2/db2inst1/arch2
db2stop force
db2 update db cfg for jikedb1 using LOGARCHMETH1 "disk:/home/DB2/db2inst1/arch2"
# 重启，并连接到jikedb1库上
db2stop force
db2start
# 启用归档日后需要再次执行一次离线全备份后，才能再次连接，否则此时就无法连接访问数据库
db2 BACKUP DATABASE jikedb1
# 另外一个窗口再次连接
db2 connect to jikedb1

# 当前窗口查看连接,可以看到有一个应用程序连接了数据库
db2 list applications

# 再次在线备份-》成功
db2 BACKUP DATABASE jikedb1 online
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/69ae1c7e-a9f0-475f-a0ca-ed2e4f73a9d9.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1ac9e23f-ce3b-43eb-bdc9-1c6aa5a0f94e.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3529bb53-221a-4a96-8091-41a95880e022.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/208f484c-838f-44cb-8240-084fc78d57f6.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0e53243a-cb3c-412f-ba9a-422285e59cdf.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3ea32b73-710f-493b-9098-8f40160dc114.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/bb59e264-23d5-4fb6-bf39-226f6f4d1a3b.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/cfc8e857-f155-47f1-a726-d40cebb72504.png)

### （3）在线备份指定备份过程中备份日志文件

```shell
# 只对在线备份生效
db2 BACKUP DATABASE jikedb1 online include logs
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b7ebbeea-e0e3-40c3-ad69-300e9aca8772.png)

### （4）指定多个路径备份

```shell
mkdir db1
mkdir db2
mkdir db3

# 因为jikedb1数据库开启了归档日志，所以需要添加online在线备份
db2 BACKUP DATABASE jikedb1 online to /home/DB2/db2inst1/db1,/home/DB2/db2inst1/db2,/home/DB2/db2inst1/db3
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/91a92dd2-b0be-4c71-8813-2fe68e4f0e38.png)

### （5）指定表空间备份

```shell
mkdir db

# 因为jikedb1数据库开启了归档日志，所以需要添加online在线备份
db2 "backup database jikedb1 tablespace (syscatspace,userspace1) online to /home/DB2/db2inst1/db"
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/47c59faf-fe93-4e52-99f6-065ba1d303ca.png)

### （6）增量在线备份

```shell
# 注意：需要在设置数据库参数logarchmeth1及开启归档日志的基础上，设置trackmod参数值为on，开启增量备份，否则报错
# 之前已经设置过了数据库参数logarchmeth1
db2 update db cfg for jikedb1 using trackmod on
# 查看jikedb1中的 trackmod参数
db2 get db cfg for jikedb1|grep -i trackmod

# 执行一次全备份后，才能再次执行增量备份
db2 backup database jikedb1
# 增量在线备份
db2 backup database jikedb1 online incremental to /home/DB2/db2inst1/db
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/fe02e4f9-f8cc-4356-9d4a-be01a7556306.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3e5449f3-c3a7-413b-809f-e03533e676f6.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0367a484-0e1a-4729-8b5a-73d10768540b.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/81f30a0c-e087-4692-924e-998dde585597.png)

### （7）变量增量备份(delta)

```shell
db2 backup database jikedb1 online incremental delta to /home/DB2/db2inst1/db
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0b4b1390-6ca5-4e7d-a5ba-13c02c1182db.png)

### （8）其他

- 数据库wsdb所有分区都做了备份，备份到目录/dev3/backup下 。

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1586eb49-9dbc-404b-9949-86e190b6d88d.jpg)

- 备份数据库sample，使用TSM（Tivoli Storage Manager）作为备份设备，并且打开了2个会话使用了4个缓冲。

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/296779da-ae06-4dc8-8c97-91c2dfea7e29.jpg)

- 备份数据库wsdb的1和2两个分区下的表空间USERSPACE1，并且使用的是在线备份，使用TSM（Tivoli Storage Manager）作为备份设备。

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/edd3e23d-3d0e-4ded-8b8f-9e1b6322b065.jpg)

## 4、检查备份的完整性

### （1）db2ckbkp命令的作用

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a2923039-5ab2-4027-8336-e3ee13c0e828.jpg)

### （2）db2ckbkp的示例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/dcbb6e62-c67d-428e-9e68-74334acebe8d.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ee545552-1061-42b2-b0a3-fac976290520.png)

# 八、DB2数据库与表空间的恢复

## 1、恢复历史记录文件

### （1）恢复历史记录文件的作用

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/114ac647-25e6-49b9-a44b-b06e1cae0961.jpg)

### （2）哪些操作会更新恢复历史记录文件

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/da9d06f9-53b7-482e-b5b4-be40f537d5ef.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/276a936c-d67b-458c-92fb-d4c52910987b.jpg)

### （3）查看恢复历史记录文件的语法

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ed22b44e-890b-4cdf-8c3a-f226c04368b3.jpg)

### （4）查看恢复历史记录文件的示例

- 查看数据库sample自从1988年2月1号以来曾经发生过的更新过历史文件的信息

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/56f203ef-32ea-423e-8bf8-3609ef37b878.jpg)

- 查看数据库sample曾经包含备份表空间userspace1的备份操作

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1505b904-0fbf-42d1-ada3-daa99f529a41.jpg)

- 查看数据库sample曾经删除或废弃表的所有数据库操作

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b3ac7a57-8896-42db-930d-caf9c26c8c0a.jpg)

- 查看数据库sample所有的操作

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c62b3122-b4ef-421c-a477-54a6482aac07.jpg)

- db2_all是在分区数据库中才使用的命令，查看数据库sample自从2001年4月1号以来发生过的备份信息

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1535d63c-4d1e-4a06-a82c-1d058edd1c27.jpg)

- 查看数据库sample自从2009年10月20号16点32分以来发生过的备份信息

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/9ce09e42-7789-4a7f-9af9-413ff9ded0b0.jpg)

### （5）查看恢复历史记录文件的内容

对比上面的截图

#### ① Op -> Operation

A：创建表空间                        N：重命名表空间

B：数据库做了备份操作                 O：删除表空间

C：复制                             Q：数据库停顿操作

D：删除表                            R：数据库做了恢复操作

F： 数据库做了前滚操作                 T：修改表空间

G： 数据库做了重组操作                U：卸载操作

L：数据库装入新的数据                 X：针对日志做了归档

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/fb5c4eae-7fec-494b-82f8-00e1b057563d.jpg)

#### ② Obj ->Object

D：数据库

I： 索引

P：表空间

T：表

R：分区表

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/8e8d1349-4fca-4820-91db-8c24a80101ab.jpg)

#### ③ Type

- 修改表空间操作的类型

C：添加容器

R：重新均衡表空间

- 归档日志操作的类型

F：归档错误

M：针对第二个日志路径进行了镜像

N：归档的命令

- 备份或恢复操作的类型

D：变量增量离线备份 

E：变量增量在线备份 

F：离线备份

I： 增量离线备份 

M： 合并操作

N： 在线备份 

O： 在线增量备份 

R： 重建操作

Z：停顿重置操作

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/bf0f7ffa-d395-4d34-bb3f-c8f4a96cf962.jpg)

## 2、数据库与表空间的恢复

### （1）还原语法

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/9cfc9df2-1744-4eb5-8ad8-9f3d02e7dcb9.jpg)

### （2）分区数据库的还原

如下，数据库备份了四个分区的数据文件（DBPART000代表0分区的备份文件）

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2589dbfa-1c1e-4f46-ab48-e30ec39f4dd6.jpg)

- 针对0、1、2、3四个分区，恢复数据库wsdb,恢复目录/dev3/backup下自2008年2月24号12点34分的备份文件，还是恢复到数据库wsdb中，并且设置wsdb中如果存在就替换

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b768defc-8a32-41ab-95a5-3032afa4d25b.jpg)

### （3）增量备份的还原

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2dff365e-5977-4900-b441-2ababe0a1ce4.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/bc151bf0-23e3-4631-b2d2-baf6bd0c1b92.jpg)

### （4）前滚语法

使用日志来恢复：

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/4e70ea00-9f81-4add-a353-6e12f704d98d.jpg)

### （5）前滚恢复的示例

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/379d904c-1634-40e8-862b-1d4083d1de3a.jpg)

## 3、数据库与表空间的恢复的示例

### （1）不完全恢复

```shell
# 启动并连接到jikedb1库上
su - db2inst1
db2start
# 查看实例下的数据库
db2 list db directory
# 连接到jikedb1数据库
db2 connect to jikedb1

# 1、创建测试表,若创建失败提示有重名，则db2 drop table mytable删除后再创建
db2 "create table mytable(id int)"

# 2、插入测试数据
db2 "insert into mytable values(1)"

# 3、检查测试数据
db2 "select * from mytable"

# 4、在线备份数据库,记录下时间戳，用于后面恢复数据库
db2 backup database jikedb1 online

# 5、在测试表中插入测试数据
# 需要重新建立连接
db2 connect to jikedb1
db2 "insert into mytable values(2)"

# 6、检查测试数据
db2 "select * from mytable"

# 7、查看备份信息
db2 list history all for jikedb1

# 8、恢复数据库
db2 restore database jikedb1 taken at 20200603164926

# 9、前滚数据库，这里只恢复到数据库备份的那个节点结束
db2 rollforward database jikedb1 to end of backup and complete

# 10、检查测试数据
# 需要重新建立连接
db2 connect to jikedb1
db2 "select * from mytable"
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/8e3a2661-6f43-4b25-98e7-f76860654373.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0754d549-658a-4bf3-b387-4df92cb045d7.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/29ef8d7e-d3b2-4047-bab6-b226963082c2.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b200dc0f-1408-4882-81cc-af16abc88acd.png)

### （2）完全恢复 

```shell
# 接上面的例子
# 在线备份数据库以及日志,记录下时间戳，用于后面恢复数据库
db2 backup database jikedb1 online include logs

# 在测试表中插入测试数据
# 需要重新建立连接
db2 connect to jikedb1
db2 "insert into mytable values(2)"
# 检查测试数据
db2 "select * from mytable"

# 查看备份信息
db2 list history all for jikedb1

# 恢复数据库
db2 restore database jikedb1 taken at 20200603170638

# 前滚数据库，这里恢复到数据库最新的日志结束
db2 rollforward database jikedb1 to end of logs and complete

# 检查测试数据
# 需要重新建立连接
db2 connect to jikedb1
db2 "select * from mytable"
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b2fca679-9aab-4777-9069-56129da8a453.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/0b91457f-acd2-4a93-a991-58e51a7a6eae.png)

### （3）表空间恢复场景

```shell
# 接上面例子
# 查看当前数据库有几个表空间
db2 list tablespaces

# 查看备份信息,找到之前全库备份的记录，记下时间戳20200603170638
db2 list history all for jikedb1

# 恢复某个表空间
db2 "restore database jikedb1 tablespace(USERSPACE1) online" taken at 20200603170638" "

# 查看表空间状态
# 重新连接
db2 connect to jikedb1
db2 list tablespaces

# 前滚表空间
db2 "rollforward database jikedb1 to end of logs and complete tablespace (USERSPACE1)"

# 查看表空间状态
# 重新连接
db2 connect to jikedb1
db2 list tablespaces
```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/972c9cc9-0387-4cbc-b17e-876a04e85f56.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/8f57be9d-ee94-450a-ae8e-9931a793100f.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2bfe7181-d014-4d0c-9ecc-0ef3b93c7d40.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b7772046-5c5a-4973-9037-a28196152590.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/777523e8-0a57-4f3c-aff2-7955b387c4d2.png)

### （4）数据库的增量恢复

```shell
# 接上面例子
# 对数据库进行在线的全备份
# 在线备份数据库以及日志,记录下时间戳，用于后面恢复数据库20200603172616
db2 backup database jikedb1 online include logs

# 对数据进行增量备份,记录下时间戳20200603172902
db2 backup database jikedb1 online incremental include logs

# 检查数据库的备份信息
db2 list history all for jikedb1

# 恢复数据库（增量备份）
db2 restore database jikedb1 incremental automatic taken at 20200603172902

# 前滚数据库
db2 rollforward database jikedb1 to end of logs and complete

```

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a4c01498-f49f-476a-8d4f-5f0aa659c3da.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a7d7584f-faca-4074-8dbc-ce4e5dc32cbb.jpg)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/90d54a91-f6f7-4df0-8cfe-93f782e53a47.png)

![img](file:///D:/Documents/My Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/83695bb2-76b0-47ce-a15d-2183eb27106c.png)

# 九、DB2中的数据类型、表与约束

## 1、DB2中的数据类型

### （1）为什么要讲数据类型

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/08391b30-efc1-4bb8-ac6a-f21bfd830d92.jpg)

### （2）DB2中的数据类型

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/805c82bd-9979-4534-9e11-8e4eef561cf2.jpg)

#### ① 数字数据类型-整数

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/dcd7ee78-d023-47ab-aa0d-a3db138812a4.jpg)

#### ② 数字数据类型-小数

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/d6b66967-8010-48ce-92f5-8e0057f8f2c7.jpg)

#### ③  数字数据类型-浮点数

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1437c726-e17c-494e-a01d-2b6e669adc40.jpg)

#### ④ 字符串数据类型-单字节字符串

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f2ee1afa-8b68-48fa-ae9e-aeea25852525.jpg)

#### ⑤  字符串数据类型-双字节字符串

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/cf446625-53c0-494f-917c-7a7732087d7b.jpg)

#### ⑥  字符串数据类型-长数据类型

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5d4dc7a8-04ca-4c51-9099-a1431e04855b.jpg)

#### ⑦ 日期时间数据类型

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/25c22cb9-0044-4fcf-88c8-d6595331698b.jpg)

#### ⑧ XML数据类型

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/581c7701-57ad-4cc3-aff4-1a7a1974e911.jpg)

#### ⑨ 用户定义的数据类型

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/dd957978-f850-4667-a998-ee8a7d56fe5e.jpg)

## 2、表

### （1）表简介

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/15bdcb3f-d31a-44b0-ac70-f679013ca87c.jpg)

### （2）创建表的示例1

```shell
# 启动
su - db2inst1
db2start

# 查看数据库
db2 list db directory

# 连接到test数据库中
db2 connect to TEST

# 创建表
db2 "CREATE TABLE employee(id INTEGER,name VARCHAR(10),gender CHAR(1))"

# 查看表的格式
db2 describe table employee
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7705d2a4-330e-4f6e-9a3f-331efa65b0d8.png)

### **（3）创建表的示例2**

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/964f032e-6c8e-4273-bfea-13192958f465.jpg)

```shell
# 接上面的例子
# 创建表employee1,结构和表employee一模一样
db2 "CREATE TABLE employee1 like employee"

# 查看表的格式
db2 describe table employee1
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/eaba80a5-0a16-43d6-aa6b-3333702fbd51.png)

### （4）创建表的示例3

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ba88a843-d592-41b9-af73-c441f7426d34.jpg)

```shell
# 接上面的例子
# 查看表空间
db2 list tablespaces

# 创建表employee2,指定表空间USERSPACE1
db2 "CREATE TABLE employee2(ID INTEGER) IN USERSPACE1"

# 查看表
db2 "select TABNAME,TBSPACE from syscat.tables where TABNAME = 'employee2'"
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/cdb3b801-5ec2-43cb-92e2-f593363eb64b.png)

### （5）修改表的示例1

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/eb22f764-9ced-46b5-8550-2e5844c25694.jpg)

```shell
# 接上面的例子
# 为表employee添加新的一列
db2 "ALTER TABLE employee ADD depart_id integer"

# 查看表的格式
db2 describe table employee
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2054fca6-d8a8-43c7-b8f3-e0da9430027c.png)

### （6）修改表的示例2

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c4e7ef62-8cfe-4ea2-b283-c4abf10eb152.jpg)

```shell
# 接上面的例子
# 修改表employee的name列类型改为varchar(20)，修改gender不为空
db2 "ALTER TABLE employee ALTER name SET DATA TYPE VARCHAR(20) ALTER gender SET NOT NULL"

# 查看表的格式
db2 describe table employee
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e753b08e-2211-49d7-a1fd-9a9f6e29684b.png)

### （7）删除表

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/28d66623-a5a4-4fe8-a86d-48fcd0803292.jpg)

```shell
# 接上面的例子
db2 "drop table employee"
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5e4c7826-d57e-414d-9c51-4ede5cdc1003.png)

## 3、约束

### （1）什么是约束

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/be2efc9c-846b-4ef3-9570-06b9cb81eb49.jpg)

### （2）唯一性约束

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/8485e47d-3b5b-46fa-8790-1978cb923844.jpg)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c074c016-70ca-4595-9914-21641ca5a7a9.jpg)

```shell
# 接上面的例子
# 创建表employee，emp_id为主键，pep_id身份证为唯一约束
db2 "CREATE TABLE employee 
(emp_id integer NOT NULL PRIMARY KEY,
name VARCHAR(10),
gender CHAR(1),
dept_id integer,
pep_id CHAR(20) NOT NULL CONSTRAINT pepid UNIQUE,
salary DECIMAL(10,2))"

# 插入数据验证
db2 "insert into employee values(1,'sara','M',3,'1233566',1000)"
# 查询
db2 "select * from employee"
#再次插入一条相同数据-》报错，因为主键和唯一性约束的原因
db2 "insert into employee values(1,'sara','M',3,'1233566',1000)"
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/d552f11f-a770-423a-a9d6-b567d75fdd98.png)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ea723708-8475-4af9-b09c-0a3ef110f4dd.jpg)

### **（3）参照完整性约束**

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5fa24461-a651-4708-9b7a-e68c7ddc9992.jpg)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/df2a4f68-260f-4f83-89d9-194775adcb5d.jpg)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/cb031c6c-a30e-42ab-8130-f7e54ea6403a.jpg)

```shell
# 接上面的例子
# 先删除
db2 "drop table employee"
# 创建部门表
db2 "CREATE TABLE department(dep_id INTEGER NOT NULL PRIMARY KEY, name VARCHAR(20))"
# 查看部门表的格式
db2 describe table department

# 创建表employee，emp_id为主键，dept_id为外键
db2 "CREATE TABLE employee 
(emp_id integer NOT NULL PRIMARY KEY,
dept_id integer not null,
foreign key(dept_id) references department(dep_id))"

# employee表插入数据-》失败，因为部门未插入数据，由于外键约束所以插入失败
db2 "insert into employee values(1,3)"

# department表插入数据
db2 "insert into department values(3,'hr')"
# employee表再次插入数据-》成功
db2 "insert into employee values(1,3)"

# 查询
db2 "select * from department"
db2 "select * from employee"
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/480cf991-e6b3-4a0b-bc4c-3e02a51de9a1.png)

### **（4）表检查约束**

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ca85831a-c013-4837-8abb-49947f694f9d.jpg)

```shell
# 接上面的例子
# 先删除
db2 "drop table employee"
# 创建表employee
db2 "CREATE TABLE employee (id integer,gender CHAR(1))"
# 查看表结构
db2 describe table employee

# 修改表,设置gender添加检查约束，值必须为M或F
db2 "ALTER TABLE employee ADD CHECK(gender IN ('M','F'))"

# 插入数据->成功
db2 "insert into employee values(1,'M')"
# 插入数据->失败
db2 "insert into employee values(1,'A')"
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c5c8bd0a-03bb-42f2-bab4-b861811018b6.png)

# 十、DB2中的对象视图、索引和触发器

## 1、视图

### （1）视图简介

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/4e74ac77-4b45-468d-ab2f-b3cb7ade3654.jpg)

### （2）创建视图

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/517c0672-2024-4ade-aaab-bd4fa428cd83.jpg)

```shell
# 接上面的例子
# 先删除
db2 "drop table employee"

# 创建表employee
db2 "CREATE TABLE employee 
(emp_id integer NOT NULL,
name VARCHAR(10) NOT NULL,
gender CHARACTER(1) NOT NULL,
dept_id BIGINT NOT NULL,
salary DECIMAL(5,2) NOT NULL)"

# 插入数据
db2 "insert into employee values(1,'sara','M',3,45.45)"
# 查询
db2 "select * from employee"

# 创建视图：查看个别字段
db2 "create view view_common as select emp_id,name,gender from employee"
#创建视图：查看所有字段
db2 "create view view_mananger as select * from employee"

# 查询视图
db2 "select * from view_common"
db2 "select * from view_mananger"
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1aeb3e72-2f67-45ed-a254-0d685bd5de98.png)

### （3）删除视图

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5e72eb0e-4c5c-48e7-9756-29535c943414.jpg)

```shell
# 查看syscat.views视图的结构
db2 describe table syscat.views
# 查看指定视图是否有效-》有效
db2 "select VIEWNAME,VALID from syscat.views where VIEWNAME='VIEW_MANANGER'"

# 删除表employee，再次查看视图-》无效
db2 "drop table employee"
db2 "select VIEWNAME,VALID from syscat.views where VIEWNAME='VIEW_MANANGER'"
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/cfd89417-0644-4a43-8bfb-d488802cf198.png)

### （4）修改视图

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/025fc9bb-7979-4213-99f2-bda972250cca.jpg)

### （5）只读视图和可更新视图

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1059ed15-07a6-428b-9198-1624bb0fa929.jpg)

```shell
# 查看指定视图是只读视图还是可更新视图
db2 "select VIEWNAME,READONLY from syscat.views where VIEWNAME='VIEW_MANANGER'"
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/1c6ae147-412c-4728-99c3-fff8cf925c41.png)

## 2、索引

### （1）索引简介

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b0ecbc46-5fa0-4b38-b410-13cb225301dc.jpg)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/dfc127ce-af0c-4c65-9a07-f5f4fa53391a.jpg)

### （2）创建索引

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5767e363-2ec4-47a2-9f65-c6b14e687638.jpg)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6cf69b2c-35b0-42a0-98aa-bf4a4665857a.jpg)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/503ed9bb-5c90-42e6-a0e2-b0162e98183c.jpg)

## 3、触发器

### （1）触发器定义

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6ef314d1-bfa6-44cb-9b57-4f145ca66d0c.jpg)

### （2）触发器的分类

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c1d3857a-81c4-4bd9-84ca-2da3f388e7a5.jpg)

### （3）触发器的示例

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5954dc9e-5366-4d47-93f6-0b3b651e74e0.jpg)

# 十一、DB2 SQL快速入门

## 1、SQL简介

### （1）SQL介绍

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/26c51655-bc3e-4430-8683-ed092308b225.jpg)

### （2）SQL的分类

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3b0bffa9-d5ac-473b-b785-73527687ed88.jpg)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/22594245-9070-4aef-aacf-a97a0b6f0584.jpg)

## 2、SQL中的查询操作

### （1）SELECT语句

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/bf267f5b-63ec-43da-86fb-d7518c9b8827.jpg)

### （2）SELECT语句示例

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/fa3bc32f-9ba5-4266-b07d-3643f9978263.jpg)

### （3）WHERE子句

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/9119e0b0-2f80-4788-acfd-467fe157966a.jpg)

### （4）WHERE子句示例

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/53d93732-65aa-4e51-a126-caddb471f269.jpg)

### （5）子查询

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e9c66b72-be70-4b87-af8c-3644d741d0a4.jpg)

### （6）相关名称

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/aabc33b9-c583-406b-93e9-ecd0ba8ee2b0.jpg)

### （7）ORDER BY子句

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/479e501b-0a0e-4a9d-9ab8-5ec94b71b11c.jpg)

### （8）GROUP BY子句

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2314e209-7336-4e28-9bf1-c03992d04eb3.jpg)

## 3、SQL中的插入、更新与删除操作

### （1）INSERT语句

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ac34ab92-a0f5-4f88-b06c-6d926293f812.jpg)

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3433dc4c-2add-4ac2-8aaf-72359508977e.jpg)

### （2）UPDATE语句

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ca978e64-a60c-435e-a13f-dd528eb55c54.jpg)

### （3）DELETE语句

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/d71a6bbc-8d88-4a4a-9866-354ac2905084.jpg)

# 十二、DB2数据的导入导出

## 1、DB2数据导入导出工具介绍

### （1）DB2数据移动程序

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c8c5b0f0-aad1-4a94-a7bd-873cfa214c4b.jpg)

### （2）文件格式-ASC

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/be35cbc6-3df8-4b67-8f57-044af290026d.jpg)

### （3）文件格式-DEL

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/9e3ea6e7-ae9d-4a34-b019-0071c8532310.jpg)

### （4）文件格式-PC/IXF

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3d81b016-3885-46b0-b353-9bf199027c8f.jpg)

### （5）文件格式-WSF

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/f2c9bcbc-b638-44ae-a154-14f8ce3f7c66.jpg)

## 2、DB2导出工具的使用

### （1）DB2 EXPORT

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/b1ec3a71-e900-4ba2-b658-88f761e2bdf6.jpg)

### （2）DB2 EXPORT示例

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/ecd3ad4f-33d9-4927-a792-5b9722749d9a.jpg)

### （3）文件类型修饰符

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/288d4252-c963-4a60-a68f-fc4c37b3183f.jpg)

### （4）常用的文件类型修饰符

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/61e3f756-4357-49ae-ad92-12df5b967adc.jpg)

### （5）文件类型修饰符示例

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/7f2f6ce2-efd7-4ca4-a7ec-39645f74c4b5.jpg)

### （6）导出大型对象

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/6fae5bc3-10d6-4b13-b780-fd0205fdefc4.jpg)

```shell
#1.字段中有回车换行符
#2.大数据对象clob

# 特殊导出（实例）：
EXPORT TO 'D:\Program Files\Quest Software\Quest Central for DB2 v4.9\Data\T_ALL_DOC.del' OF DEL
LOBS TO  'D:\Program Files\Quest Software\Quest Central for DB2 v4.9\Data\lob\'
MODIFIED BY chardel# coldel$ LOBSINSEPFILES MESSAGES msg.out
select "DOC_ID", "DOC_TITLE", "DOC_NAME", "DOC_CLASS", "DOC_DATE", "DOC_PATH", "DOC_AUTHOR", "KEYWORD", 
REPLACE(SUMMARY, CONCAT(CHR(13),CHR(10)), CHR(59)) AS SUMMARY, "HTMLCONTENT","UPDATE_TIME","CLASS_CHILD" from "DOCS"."T_ALL_DOC";

一般导出（实例）：
EXPORT TO 'D:\Program Files\Quest Software\Quest Central for DB2 v4.9\Data\T_DOC_CLASS.del' OF DEL
SELECT * FROM "DOCS"."T_DOC_CLASS";

```





## 3、DB2导入工具的使用

### （1）DB2 IMPORT

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/cdf6a29d-624d-452d-95db-2625a5a30ccc.jpg)

### （2）IMPORT选项

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3d2c4aac-611f-4a5b-b96e-20148c506e0f.jpg)

#### ① INSERT选项

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/c2c1123b-5597-4749-bee5-eeaf8aa76c19.jpg)

#### ② INSERT_UPDATE选项

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/07a3f85c-5a76-41f1-bcaa-c5a81ecfd9f9.jpg)

#### ③ REPLACE选项

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2d47bc0f-ef8c-483d-abb4-e0c8ded32a0e.jpg)

#### ④ REPLACE_CREATE选项

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/51ce993f-2158-4ff6-9e19-7c05d1b537f2.jpg)

#### ⑤ CREATE选项

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/e33c6941-91e6-4d9e-acb8-9dc5c5fd599a.jpg)

### （3）IMPORT示例

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a66c452f-f04b-423a-86f2-2de5de034bc7.jpg)

 

```shell
#1.字段中有回车换行符
#2.大数据对象clob

# 特殊导入（实例）：
IMPORT FROM 'D:\Program Files\Quest Software\Quest Central for DB2 v4.9\Data\T_ALL_DOC.del'OF DEL
LOBS FROM 'D:\Program Files\Quest Software\Quest Central for DB2 v4.9\Data\lob\' MODIFIED BY chardel# coldel$ lobsinfile MESSAGES msg.in 
INSERT INTO "DOCS"."T_ALL_DOC";



一般导入（实例）：
IMPORT FROM 'D:\Program Files\Quest Software\Quest Central for DB2 v4.9\Data\T_DOC_CLASS.del' OF DEL
INSERT INTO "DOCS"."T_DOC_CLASS";
```





### （4）IMPORT的原理与思考

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/2325b4c4-6020-4a48-af0b-b55852054341.jpg)

 

```shell
# COMMITCOUNT示例
IMPORT FROM myfile.ixf OF IXF COMMITCOUNT 500 MESSAGES msg.out INSERT INTO newtable

# AUTOMATIC 示例
IMPORT FROM myfile.ixf OF IXF COMMITCOUNT AUTOMATIC MESSAGES msg.out INSERT INTO newtable
```





## 4、DB2-LOAD工具详解(大量数据导入)

### （1）LOAD工具简介

LOAD是DB2数据库中一种数据移动实用程序，LOAD的原理是将输入的数据源直接格式化成数据页存储到数据库中，在装载过程不会触发触发器，并且除了唯一性约束以外不执行引用约束检查或表约束检查，只记录少量日志或不记录日志。因此对于需要将大量的数据插入到表中的场景具有特别高的性能。LOAD支持绝大多数数据类型，其中包括 XML、大对象 (LOB) 和用户定义的类型 (UDT)。 

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/5d7909ca-9216-4e08-914d-fa55747e7a5d.jpg)

### （2）LOAD支持的源数据格式

LOAD实用程序支持以下源数据：

-   DEL 定界的ASCII文件
-   ASC非定界的ASC文件
-   IXF 数据库改版的集成交换格式文件
-   源数据库表

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/060c5799-2f87-4ed2-99e3-2a0d689154a5.jpg)

### （3）LOAD的模式

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/a6c7c204-e823-4e44-a2c4-57e784984144.jpg)

### （4）Import与Load的对比

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/3f5e0d1d-30ac-4df2-a498-a2e82ea59033.jpg)

### （5）LOAD装入操作的4个阶段

#### ① 分析阶段

目标表为列式存储的表才会有此阶段，行式存储表则没有。

#### ② 装入阶段

装入阶段将源数据解析成物理数据页的格式，直接装入到数据页中。必要时还收集索引键和表统计信息。

#### ③ 构建索引阶段

根据在装入阶段收集的索引键创建表索引。

#### ④ 删除重复阶段

在此阶段将违反了主键约束和唯一约束的行删除（主键约束包含了唯一约束），如果定义了异常表，这些删除的行将会插入到异常表中，在装载完成后可以查询异常来查看那些行违反了唯一性约束。

### （6）LOAD命令及常用选项

```shell
load client from FILENAME of del modified by codepage=1386 coldel; chardel' dumpfile=PATH/FILENAME messages PATH/FILENAME insert into TABLEBAME for exception TABLENAME ALLOW READ ACCESS
```

```shell
# 选项说明：
# LOAD  说明此次操作为LOAD
# client 此选项说明load在客户端而非数据库服务器上操作，如果在数据库服务器上操作load，则不要加该参数
# from 源数据文件，需要指定文件的路径及文件名，如果加了client参数，该路劲必须为绝对路径。
# of del 数据文件格式，del表示源文件为定长的ASC文件
# modified by 指定文件类型修饰符选项，在by后面到insert前面的参数都属于该选项的参数，这些参数可以组合使用，每个选项用空格隔开。
              # 以下对常用的选项进行说明：
              # codepage=1386  指定输入的源数据文件的代码页，如果输入的源数据文件与目标数据库的代码页不一致，可以能会出现乱码。
                               #此选项指定输入的源数据文件代码页，load根据指定的代码页转换为目标数据库的代码页，
                               # 如果导入的源数据量非常大时，转换过程会很消耗时间，
                               # 因此建议在生成源数据文件时就指定代码页与数据库代码页一致，这样就可以节省代码页转换时间。

             # coldel;  指定插入数据的列分隔符为分号; 。如果不指定该参数，默认列分隔符为逗号, 
                        #如果源文件中的列分隔符是其它分隔符，则通过该参数进行指定，coldel与分隔符中间不要留空格。
             # chardel' 指定插入的源数据中字符串分隔符为单引号''。如果不指定该参数，默认的字符串分隔符为双引号""，
                        #如果源数据中字符串分隔符为其它分隔符，则通过该参数进行指定，chardel与分隔符中间不要留空格。
                        
# dumpfile=PATH/FILENAME   指定转存文件的目录及文件名，在装入阶段，如果源文件的某一行中有某些的数据类型不符合目标表中对应的列的数据类型时，
                          #则将该行数据保存在该转存文件中，在load操作完成后可以查看该文件，检查哪些行有不符合的数据类型，
                          #这个文件在装入阶段生成的。该文件保存在服务器中。

# messages PATH/FILENAME   指定在load过程产生的信息文件，该文件在load结束后生成，可以查看该文件了解load操作过程中的相关信息。
                           #如果LOAD命令从client发起，该信息文件保存在客户端。


# insert    表示将源数据插入到目标表中而不影响目标表中原有的数据，该选项不影响目标表原有的数据，适合于对目标表进行追加数据操作。
            #除了insert外还有replace、restart、terminate。详细说明如下:
            # replace    表示先将目标表中数据清空，然后再将源数据插入到目标表中，该选项会破坏目标表原有数据，谨慎使用
            # terminate  表示终止load操作，并将数据恢复到load开始时的状态。如果在load.. replace出现load pending，采用load..terminate会清空表数据。
            # restart    表示重启被中断的load操作，restart会使用之前load时产生的临时文件，并从最近一个点开始重新load，
                         #因此不要手动删除load产生的临时文件，这些临时文件会在load完成后自动删除，
                         #这些临时文件会在当前工作目录中生成，也可以通过tempfile path选项指定，这些临时文件大小与源数据文件大小相同。
            # 说明：insert、replace在刚刚开始进行load进行指定，两者选一个。
                    #terminate、restart在load过程中因为中断或者失败导致表处于load pending状态，
                    #为了处理这些异常而进行的后续处理。

# into TABLENAME  需要将源数据插入的目标表
# for exception TABLENAME  指定异常表，该表主要保存在删除阶段因为违反唯一性约束而插入失败的行数据，该表必须在load之前创建好，
                           #表结构前N列定义与目标表相同列定义要一致，只是在表最后增加两列，一列用于记录行被插入的时间戳，
                           #一列用于记录插入失败原因信息的clob列。如果不指定异常表被删除的行会丢失。

# ALLOW READ ACCESS  指定LOAD表处于只读状态。默认情况LOAD期间目标表会处于不可读状态，需等LOAD完成后表处于正常状态才可对表进行DML操作。
                    #若在LOAD命令加上该参数，则其它应用可读取目标表中LOAD之前已存在的数据，正在插入的数据仍不可读。
                    #此参数不能与replace同时使用，否则会报SQL3340N 代码为1错误。
```

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/70819cb9-d137-470d-892d-285120dedda0.png)

### （7）LOAD监控及表状态监控

LOAD属于DB2的一个实用程序，可以通过db2 LIST UTILITIES SHOW DETAIL来监控load的进程。

对于表状态的监控则用通过名：db2 load query table TABLENAME来监控，其中TABLENAME为LOAD操作的目标表名。

详细监控情况如下：

#### ① LOAD监控

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/47cb600a-002d-4372-a259-c51db893a9e7.png)

#### ② LOAD期间表状态监控

![img](file:///D:/Documents/My%20Knowledge/temp/2e9fe3d9-50e5-4be1-b731-b8ca5d44df09/128/index_files/70740d5b-18cf-4366-b039-7a50f932f856.png)

### （8）LOAD操作常见问题

**①** 在LOAD过程中，在删除违反唯一性约束阶段会记录事务日志，如果目标表中有某些列创建了唯一性约束，而插入的源数据中该列存在大量重复值，那在LOAD操作的删除阶段会产生大量的事务日志，此时有可能会导致事务日志满操作

**处理**：

- 1、修改源数据文件中这些列的值，让这些列值符合唯一性
- 2、如果需要将源数据中这些重复值插入目标表中，则先将目标表中这些列的唯一约束删除，然后在执行LOAD操作。
- 3、增加事务日志大小，以满足此次LOAD操作需求

**②** 执行LOAD命令的用户对源数据文件无权限，此时会报SQL3508N错

**处理**：将源文件的读权限授予执行load命令的用户，在重新执行load命令